<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>DAME Algorithm: AME Lab</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="simple-sidebar.css" rel="stylesheet">
  <!--Additional custom styling -->
  <link href="additional.css" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>

</head>

<body>

  <div class="d-flex" id="wrapper">

<!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper"><div id="sidebar-content">
	  <a href="index.html"><div class="sidebar-heading sidebar-heading-logo"><img class = "logo-alt2" src = "logos/logo_alt2.svg" alt = "duke logo"></div></a>
      <div class="list-group list-group-flush">
		<a href="about-us.html" class="list-group-item list-group-item-action bg-light">About Us</a>
        <a href="choosing-an-algorithm.html" class="list-group-item list-group-item-action bg-light">Choosing an Algorithm</a>
		<a id="flip" class="dropdown-btn list-group-item list-group-item-action bg-light" style="color:#495057">Getting Started<i class="fa fa-chevron-down" style="font-size:16px"></i></a>
        <div id="flipped" class="dropdown-container">
          <a href="dame.html" class="list-group-item list-group-item-action bg-light">DAME</a>
          <a href="flame.html" class="list-group-item list-group-item-action bg-light">FLAME</a>
          <a href="malts.html" class="list-group-item list-group-item-action bg-light">MALTS</a>
		  <a href="ahb.html" class="list-group-item list-group-item-action bg-light">AHB</a>
        </div>
        <a href="tutorials.html" class="list-group-item list-group-item-action bg-light">Tutorials</a>
        <a href="additional-resources.html" class="list-group-item list-group-item-action bg-light">Additional Resources</a>
      </div>
    </div></div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <button class="navbar-toggler" id="menu-toggle" onclick="changeMenuText()"><span id="menuText"><span class="navbar-toggler-icon"></span></button>
        <ul class="navbar-nav ml-auto mt-lg-0">
          <a class="nav-link" href="https://github.com/almost-matching-exactly" target="_blank"><i class="fa fa-github"></i> Github</a>
        </ul>
      </nav>

      <div class="container-fluid" style="padding-bottom: 50px">
        <div class="banner"><h1 class="title mt-4">Getting Started with DAME</h1></div> 
          <div class="container">
		    <h2 style="padding-bottom:0px !important" class="languageHeader">
		    <a id="pTab" class="languageTab languageActive">Python Package</a></h2><hr class="languageHr">
			  <div class="container">
				  <div class="container">
					Please note that this package requires the installation of Python version 3 or higher. 
					If you do not already have an updated version of Python installed on your computer, you can download the latest version <a href="https://www.python.org/downloads/" target="_blank">here</a>.
					Additionally, this package is dependent on Pandas, Scikit-learn, and Numpy. If your version of Python does not have these packages, you can install them <a href="https://packaging.python.org/tutorials/installing-packages/" target="_blank">here</a>.
					We recommend installing the <a href="https://www.anaconda.com/products/individual" target="_blank">Anaconda package</a>, which comes with the Python libraries our software is dependent on already pre-installed.</div>
			    <h3 style="padding-top: 15px">Installation</h3>
				  <div class="container">
					<p>DAME is currently available in Python for download on the <a href="https://github.com/almost-matching-exactly" target="_blank">almost-matching-exactly Github</a> or for installation via PyPi (recommended). The package includes both the DAME and FLAME algorithms and can be installed with the following command:<p>
					<div class="code"><pre style="white-space:nowrap"><span id="codesample1">pip install dame-flame</span></pre><button class="codeButton" onclick="codeCopy('codesample1');showToast();borderFix()"><i class="fa fa-clipboard" style="font-size:16px"></i></button></div>
					<div id="toast">Copied to clipboard!</div>
				  </div>
				<h3>Input Data Format</h3>
				  <div class="container">
				    To begin using the DAME algorithm, first ensure that your dataset meets the necessary requirements. 
					The data can be stored as a CSV/Excel file or as a <b>Python Pandas Data Frame</b>. 
					Remember, all covariates should be catagorical and expressed as <i>integer</i> data types. If there are continuous covariates, please consider regrouping. In addition to the covariate columns,
					your dataset should include a column of binary <i>integer</i> data types which specify whether a unit is treated (1) or control (0) 
					and a column of <i>integer</i> or <i>float</i> data types which specify unit outcomes. There are no requirements for covariate column names or the ordering of the columns. 
					Below is a sample dataset in the required format:
					<div class="input-data-container"> 
					  <div class="row" style="width:100%;margin-right:-15px">
						<div class="col">
						  <table class="table table-striped" style="margin-bottom:15px;margin-top:15px;">
							<thead>
							  <tr style="text-align:center">
								<th>x_1 <span style="font-weight:normal;font-style:italic">(integer)</span></th>
								<th>x_2 <span style="font-weight:normal;font-style:italic">(integer)</span></th>
								<th>...</th>
								<th>x_m <span style="font-weight:normal;font-style:italic">(integer)</span></th>
								<th>treated <span style="font-weight:normal;font-style:italic">(binary)</span></th>
								<th>outcome <span style="font-weight:normal;font-style:italic">(numeric)</span></th>
							  </tr>
							</thead>
							<tbody>
							  <tr style="text-align:center">
								<td>1</td>
								<td>2</td>
								<td>...</td>
								<td>4</td>
								<td>1</td>
								<td>4.5</td>
							  </tr>
							  <tr style="text-align:center">
								<td>2</td>
								<td>3</td>
								<td>...</td>
								<td>7</td>
								<td>0</td>
								<td>3.33</td>
							  </tr>
							  <tr style="text-align:center">
								<td>...</td>
								<td>...</td>
								<td>...</td>
								<td>...</td>
								<td>...</td>
								<td>...</td>
							  </tr>
							  <tr style="text-align:center">
								<td>2</td>
								<td>6</td>
								<td>...</td>
								<td>1</td>
								<td>1</td>
								<td>6</td>
							  </tr>
							</tbody>
						  </table>
						</div>
					  </div>
					</div>					
				  </div>
				<h3>Usage</h3>
				  <div class="container">
				    To run the algorithm, use the <span class="function">DAME</span> function as shown in line 5. Although the <span class="function">DAME</span> function can
					operate on a file or a dataframe, the additional functions included in the package require the latter format. As such, it is recommended to
					first convert your data to a Python Pandas Data Data frame as shown in line 4:
<span id="codesample2" style="display:none">import pandas as pd
import dame_flame

df = pd.read_csv("data.csv")
result = dame_flame.DAME_FLAME.DAME(input_data=df, treatment_column_name="treated", outcome_column_name="outcome")
print(result[0])</span>
<div class="code" style="margin-top:15px"><pre><span class="import">import</span> pandas <span class="import">as</span> pd
<span class="import">import</span> dame_flame

df = pd.read_csv(<span class="string">&quot;data.csv&quot;</span>)
result = dame_flame.DAME_FLAME.<b>DAME</b>(input_data=df, treatment_column_name=<span class="string">&quot;treated&quot;</span>, outcome_column_name=<span class="string">&quot;outcome&quot;</span>)
<span class="print">print</span>(result[<span class="number">0</span>])</pre>
					<button class="codeButton" onclick="codeCopy('codesample2');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>
					The object <span style="font-weight:600">result</span> is by default a list of one entry, the first and only element of which is a dataframe containing all of the units that were matched and the covariates that they were matched on. 
					The covariates that each unit was not matched on are denoted with asterisks. The output of the algorithm may contain additional values based on optional parameters which are detailed in the next section.
					<br><br>
					To find the main matched group of a particular unit after running <span class="function">DAME</span>, use the function <span class="function">mmg_of_unit</span> as shown below:
<span id="codesample3" style="display:none">mmg = dame_flame.DAME_FLAME.mmg_of_unit(return_df=result[0], unit_id=0, input_data=df)
print(mmg)</span>
<div class="code" style="margin-top:15px"><pre>mmg = dame_flame.DAME_FLAME.<b>mmg_of_unit</b>(return_df=result[<span class="number">0</span>], unit_id=<span class="number">0</span>, input_data=df)
<span class="print">print</span>(mmg)</pre>
					<button class="codeButton" onclick="codeCopy('codesample3');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>
					To find the estimated treatment effect on a particular unit, use the function <span class="function">te_of_unit</span> as shown below:
<span id="codesample4" style="display:none">te = dame_flame.DAME_FLAME.te_of_unit(return_df=result[0], unit_id=0, input_data=df, treatment_column_name="treated", outcome_column_name="outcome")
print(te)</span>
<div class="code" style="margin-top:15px"><pre>te = dame_flame.DAME_FLAME.<b>te_of_unit</b>(return_df=result[<span class="number">0</span>], unit_id=<span class="number">0</span>, input_data=df, treatment_column_name=<span class="string">&quot;treated&quot;</span>, outcome_column_name=<span class="string">&quot;outcome&quot;</span>)
<span class="print">print</span>(te)</pre>
					<button class="codeButton" onclick="codeCopy('codesample4');showToast();borderFix()"><i class="fa fa-clipboard"></i></button></div>
				  </div>
				<h3>DAME - Parameters and Defaults</h3>
				  <div class="container">
<div class="pre-nonumbers" style="margin-top:15px"><b>DAME</b>(input_data, treatment_column_name=<span class="string">&quot;treated&quot;</span>, weight_array=<span class="print">False</span>,
     outcome_column_name=<span class="string">&quot;outcome&quot;</span>, adaptive_weights=<span class="string">&quot;ridge&quot;</span>, alpha=<span class="number">0.1</span>, 
     holdout_data=<span class="print">False</span>, repeats=<span class="print">True</span>, verbose=<span class="number">2</span>, want_pe=<span class="print">False</span>, want_bf=<span class="print">False</span>, 
     early_stop_iterations=<span class="print">False</span>, stop_unmatched_c=<span class="print">False</span>, 
     stop_unmatched_t=<span class="print">False</span>, early_stop_un_c_frac=<span class="number">0.1</span>, 
     early_stop_un_t_frac=<span class="number">0.1</span>, early_stop_pe=<span class="print">False</span>, 
     early_stop_bf=<span class="print">False</span>, early_stop_pe_frac=<span class="number">0.01</span>, 
     early_stop_bf_frac=<span class="number">0.01</span>, missing_indicator=numpy.nan, 
     missing_holdout_replace=<span class="number">0</span>, missing_data_replace=<span class="number">0</span>, 
     missing_holdout_imputations=<span class="number">10</span>, missing_data_imputations=<span class="number">0</span>)</div>
					<a onclick="expandAll(['dameKey','dameEarly','dameMissing','dameAdditional']);minusAll(['plusKey','plusEarly','plusMissing','plusAdditional'])" class="expand-all">Expand all</a>
					<a onclick="collapseAll(['dameKey','dameEarly','dameMissing','dameAdditional']);plusAll(['plusKey','plusEarly','plusMissing','plusAdditional'])" 
					class="expand-all">Collapse all</a>
					
					
					<div class="parameter-container">
					<h4 style="margin-top: 15px">Key Parameters<i id="plusKey" onclick="expand('dameKey');minus(this.id)" class="fa fa-minus-square-o"></i></h4>
					<div id="dameKey">
					<span style="color:#6c757d">* denotes DAME-specific parameters</span>
					<div class="row">
						<div class="col">
						  <table class="table table-striped" style="margin-top:15px;margin-bottom:15px;width:95%;margin-left:auto;margin-right:auto">
							<tbody>
							  <tr>
								<td class="pwidth"><b>input_data:</b><br>file, Dataframe, required</td>
								<td>The data to be matched.</td>
							  </tr><tr>
							    <td><b>treatment_column_name:</b><br>string, optional (default = 'treated')</td>
								<td>The name of the column which specifies whether a unit is treated or control.</td>
							  </tr><tr>
							    <td><b>*weight_array:</b><br>array, optional (default = False)</td>
								<td>Array of weights for all covariates in input_data. Only needed if adaptive_weights = False.</td>
							  </tr><tr>
							    <td><b>outcome_column_name:</b><br>string, optional (default = 'outcome')</td>
								<td>The name of the column which specifies each unit outcome.</td>
							  </tr><tr>
							    <td><b>adaptive_weights:</b><br>string, optional (default = 'ridge')</b></td>
								<td>The weight dropping method to be used.<br>If False, implements no weight dropping method.
								<br>If 'ridge', implement ridge regression.<br>If 'ridgeCV', implement ridge regression with cross-validation.
								<br>If 'decision tree', implement decision tree regression.</td>
							  </tr><tr>
								<td><b>alpha:</b><br>float, optional (default = 0.1)</td>
								<td>This is the alpha for ridge regression. We use the scikit package for ridge regression, so it is "regularization 
								strength". Larger values specify stronger regularization. Must be positive float.</td>
							  </tr><tr>
								<td><b>holdout_data:</b><br>file, Dataframe, optional (default = False)</td>
								<td>The data used in the holdout training set. Only required if doing an adaptive_weights version.
								If False, 10% of the input data will be randomly selected for the training set.</td>
						      </tr><tr>
								<td><b>repeats:</b><br>bool, optional (default = True)</td>
								<td>Specifies whether values for which a main matched group has been found can
									be used again and placed in an auxiliary matched group.</td>
							  </tr><tr>
								<td><b>verbose:</b><br>integer, optional (default = 2): </td>
								<td>Controls how progress is displayed while the algorithm is running.<br>
									If 0, prints nothing.<br>If 1, prints iteration number. <br>If 2, prints the
									iteration number and number of units left to match on every 10th 
									iteration.<br>If 3, prints iteration number and number of units left to match on every iteration.</td>
							  </tr><tr>
								<td><b>want_pe:</b><br>bool, optional (default = False) </td>
								<td>Specifies whether the output will include the 
									predictive error of the covariate sets matched on in each iteration.</td>
							  </tr><tr>
								<td><b>want_bf:</b><br>bool, optional (default = False) </td>
								<td>Specifies whether the output will include the balancing factor of each 
									iteration.</td>
							  </tr>
							</tbody>
						  </table>
						</div>
						</div>
					</div>
					<h4 style="margin-top:15px">Early Stopping Parameters<i id="plusEarly" onclick="expand('dameEarly');minus(this.id)" class="fa fa-minus-square-o"></i></h4>
					<div id="dameEarly">
					<div class="row">
						<div class="col">
						  <table class="table table-striped" style="margin-bottom:15px;width:95%;margin-left:auto;margin-right:auto">
							<tbody>
							  <tr>
								<td class="pwidth"><b>early_stop_iterations:</b><br>integer, optional (default = False): </td>
								<td>If provided, specifies the number of iterations after which to hard-stop the algorithm.</td>
							  </tr><tr>
								<td><b>stop_unmatched_c:</b><br>bools, optional (default = False)</td>
								<td>Specifies whether the algorithm stops when there are no control units remaining to match.</td>
							  </tr><tr>
								<td><b>stop_unmatched_t:</b><br>bools, optional (default = False)</td>
								<td>Specifies whether the algorithm stops when there are no treatment units remaining to match.</td>
							  </tr><tr>
								<td><b>early_stop_un_c_frac:</b><br>float, optional (default = 0.1)</td>
								<td>Minimum acceptable proportion of unmatched treatment units after which the algorithm will stop iterating. Must be between 0 and 1.</td>
							  </tr><tr>
								<td><b>early_stop_un_t_frac:</b><br>float, optional (default = 0.1)</td>
								<td>Minimum acceptable proportion of unmatched treatment units after which the algorithm will stop iterating. Must be between 0 and 1.</td>
							  </tr><tr>
								<td><b>early_stop_pe:</b><br>bool, optional (default = False)</td>
								<td>If True, then the algorithm will hard-stop once the covariate set chosen for matching has a predictive error greater 
								than the threshold provided in <b>early_stop_pe_frac</b></td>
							  </tr><tr>
								<td><b>early_stop_bf:</b><br>bool, optional (default = False)</td>
								<td>If True, then the algorithm will hard-stop once the covariate set chosen for matching has a balancing factor lower 
								than the threshold provided in <b>early_stop_bf_frac</b></td>
							  </tr><tr>
								<td><b>early_stop_pe_frac:</b><br>float, optional (default = 0.01)</td>
								<td>If <b>early_stop_pe</b> is True, then the algorithm will hard-stop once the covariate set chosen to match on has a predictive error greater than this value.</td>
							  </tr><tr>
								<td><b>early_stop_bf_frac:</b><br>float, optional (default = 0.01)</td>
								<td>If <b>early_stop_bf</b> is True, then the algorithm will hard-stop once the covariate set chosen to match on has a balancing factor lower than this value.</td>
							  </tr>
							</tbody>
						  </table>
						</div>
					</div>
					</div>
					<h4 style="margin-top:15px">Missing Data Parameters<i id="plusMissing" onclick="expand('dameMissing');minus(this.id)" class="fa fa-minus-square-o"></i></h4>
					<div id="dameMissing"></h4>
					<div class="row">
						<div class="col">
						  <table class="table table-striped" style="margin-bottom:15px;width:95%;margin-left:auto;margin-right:auto">
							<tbody>
							  <tr>
								<td class="pwidth"><b>missing_indicator:</b><br>string, integer, np.nan, optional (default = np.nan) </td>
								<td>This is the indicator for missing data in the dataset. 
								For example, if missing values are denoted with "NA", set this paramater equal to "NA".  </td>
							  </tr><tr>
								<td><b>missing_holdout_replace:</b><br>integer, optional (default = 0): </td>
								<td>
									If 0, assume no missingness in holdout data.<br>
									If 1, drop all units with missingness from holdout dataset.<br>
									If 2, impute missing values using <a target="_blank" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/">MICE</a> on holdout dataset for the number of imputations specified by <b>missing_holdout_imputations</b></td>
							  </tr><tr>
								<td><b>missing_data_replace:</b><br>integer, optional (default = 0): </td>
								<td>
									If 0, assume no missingness in matching data.<br>
									If 1, drop all units with missingness from matching dataset.<br>
									If 2, do not match units on covariates that are missing.<br>
									If 3, impute missing values using <a target="_blank" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/">MICE</a> on matching dataset for the number of imputations specified by <b>missing_data_imputations</b>.</td>
							  </tr><tr>
								<td><b>missing_holdout_imputations:</b><br>integer, optional (default = 10) </td>
								<td>If <b>missing_holdout_replace</b>=2, specifies the number of imputations on the holdout set.</td>
							  </tr><tr>
								<td><b>missing_data_imputations:</b><br>integer, optional (default = 1) </td>
								<td>If <b>missing_data_replace</b>=3, specifies the number of imputations on the matching set.</td>
							  </tr>
							</tbody>
						  </table>
						</div>
					</div>
					</div>
					</div>
			  </div>
			  <h3 style="margin-top:25px">Additional Functions - Parameters and Defaults</h3>
				  <div class="container">
<div class="pre-nonumbers" style="margin-top:15px"><span class="comment">#returns main matched group of specified unit</span>
<b>mmg_of_unit</b>(return_df, unit_id, input_data, output_style=<span class="number">1</span>)

<span class="comment">#returns treatment effect on specified unit</span>
<b>te_of_unit</b>(return_df, unit_id, input_data, treatment_column_name, outcome_column_name)

<span class="comment">#returns main matched group and treatment effect for specified unit and includes fancy version of above functions</span>
<b>mmg_and_te_of_unit</b>(return_df, unit_id, input_data, treatment_column_name, 
outcome_column_name, return_vals=<span class="number">1</span>)</div>
				    <div class="parameter-container">
					<h4>Key Parameters<i id="plusAdditional" onclick="expand('dameAdditional');minus(this.id)" class="fa fa-minus-square-o"></i></h4>
					<div id="dameAdditional"></h4>
					<div class="row">
						<div class="col">
						  <table class="table table-striped" style="margin-bottom:15px;width:95%;margin-left:auto;margin-right:auto">
							<tbody>
							  <tr>
								<td class="pwidth"><b>return_df:</b><br>Dataframe, required</td>
								<td>The dataframe containing all of the matches, obtained from the first element in the output of the algorithm.</td>
							  </tr><tr>
								<td class="pwidth"><b>unit_id:</b><br>integer, required</td>
								<td>The index identification for the unit of interest.</td>
							  </tr><tr>
								<td class="pwidth"><b>input_data:</b><br>Dataframe, required</td>
								<td>Dataframe containing the original dataset which has already been matched using DAME.</td>
							  </tr><tr>
								<td class="pwidth"><b>treatment_column_name:</b><br>string, required</td>
								<td>The name of the column in <b>input_data</b> which specifies whether a unit is treated or control.</td>
							  </tr><tr>
								<td class="pwidth"><b>outcome_column_name:</b><br>string, required</td>
								<td>The name of the column in <b>input_data</b> which specifies each unit outcome.</td>
							  </tr><tr>
								<td class="pwidth"><b>output_style:</b><br>integer, optional (default = 1)</td>
								<td>If 1, include only the covariates matched on in the output.<br>
								If 2, include all attributes in the output.</td>
							  </tr><tr>
								<td class="pwidth"><b>return_vals:</b><br>integer, optional (default = 1)</td>
								<td>If 0, print the main matched group and treatment effect for the specified unit (fancy version).<br>
								Else, return the main matched group and treatment effect for the specified unit with no print statement (default version).</td>
							  </tr>
							</tbody>
						  </table>
						</div>
					</div>
					</div>
					</div>
				</div>
		  </div>
      </div></div>
    </div>
    <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Menu Toggle Script -->
  <script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
  </script>
  <!-- Additional Custom Script -->
  <script src="additionaljs.js"></script>
</body>

</html>
